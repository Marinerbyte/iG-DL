<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Singularity | Interface</title>
    <meta name="description" content="A cinematic, next-generation interface for downloading web media.">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0%25' stop-color='%238a2be2'/%3E%3Cstop offset='100%25' stop-color='%23ff007f'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='url(%23g)'/%3E%3Cpath d='M50,30 L70,50 L50,70 L30,50 Z' fill='none' stroke='white' stroke-width='5' transform='rotate(45 50 50)'/%3E%3C/svg%3E">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --dark-bg: #03000a;
            --glass-bg: rgba(10, 8, 20, 0.5);
            --border-color: rgba(255, 255, 255, 0.1);
            --text-color: #f0f0f0;
            --text-muted: #8c8c9c;
            --accent-1: #8a2be2;
            --accent-2: #ff007f;
            --accent-3: #00c6ff;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        @keyframes letter-fade-in { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        body { font-family: 'Inter', sans-serif; background-color: var(--dark-bg); color: var(--text-color); height: 100vh; display: grid; place-items: center; overflow: hidden; }
        #particle-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .main-container { width: 100%; max-width: 600px; padding: 20px; perspective: 1000px; }
        .downloader-card { background: var(--glass-bg); backdrop-filter: blur(30px); border: 1px solid var(--border-color); border-radius: 24px; padding: 35px; box-shadow: 0 25px 60px rgba(0, 0, 0, 0.4); transform-style: preserve-3d; transition: transform 0.1s ease-out; animation: letter-fade-in 1s ease-out 0.5s forwards; opacity: 0; transform: translateY(20px); }
        .downloader-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; border-radius: 24px; border: 1px solid transparent; background: linear-gradient(135deg, var(--accent-1), var(--accent-2)) border-box; -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0); -webkit-mask-composite: destination-out; mask-composite: exclude; opacity: 0.5; pointer-events: none; }
        .header { text-align: center; margin-bottom: 30px; transform: translateZ(20px); }
        .header h1 { font-size: 2.2rem; font-weight: 700; color: var(--text-color); display: flex; justify-content: center; gap: 2px;}
        .header h1 span { display: inline-block; opacity: 0; animation: letter-fade-in 0.5s ease-out forwards; }
        .header p { color: var(--text-muted); font-size: 1rem; margin-top: 8px; }
        .form-content { transition: opacity 0.5s, transform 0.5s; }
        .downloader-card.state-ready .form-content, .downloader-card.state-downloading .form-content { opacity: 0; transform: scale(0.95); pointer-events: none; }
        .tabs { display: flex; justify-content: center; margin-bottom: 25px; gap: 10px; }
        .tab-item, .quality-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); color: var(--text-muted); padding: 8px 18px; border-radius: 20px; cursor: pointer; font-weight: 500; transition: all 0.3s; }
        .tab-item:hover, .quality-btn:hover { color: var(--text-color); border-color: var(--accent-3); }
        .tab-item.active, .quality-btn.active { color: #fff; border-color: var(--accent-1); background: linear-gradient(90deg, var(--accent-1), var(--accent-2)); box-shadow: 0 0 15px rgba(138, 43, 226, 0.5); }
        #url-input-wrapper { position: relative; }
        #url-input { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--border-color); background-color: rgba(0,0,0,0.2); color: var(--text-color); font-size: 1rem; transition: all 0.3s; }
        .ready-state-content, .progress-state-content { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0; transform: scale(1.05); pointer-events: none; transition: opacity 0.5s, transform 0.5s; }
        .downloader-card.state-ready .ready-state-content, .downloader-card.state-downloading .progress-state-content { opacity: 1; transform: scale(1); pointer-events: all; }
        .quality-selector { display: flex; gap: 10px; margin-bottom: 25px; }
        .download-btn { padding: 16px 30px; border: none; border-radius: 12px; background-image: linear-gradient(90deg, var(--accent-1), var(--accent-2), var(--accent-1)); background-size: 200%; color: #fff; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .download-btn:hover { background-position: 100%; box-shadow: 0 0 25px rgba(255, 0, 127, 0.5); }
        .progress-bar-container { width: 80%; background: rgba(0,0,0,0.2); border-radius: 10px; height: 20px; border: 1px solid var(--border-color); overflow: hidden; }
        .progress-bar { width: 0%; height: 100%; border-radius: 10px; background: linear-gradient(90deg, var(--accent-1), var(--accent-2)); transition: width 0.2s linear; }
        #progress-text { margin-top: 15px; font-size: 1rem; color: var(--text-muted); }
    </style>
</head>
<body>
    <canvas id="particle-canvas"></canvas>
    
    <div class="main-container">
        <div class="downloader-card" id="downloader-card">
            <div class="header"><h1></h1><p>The ultimate media downloading experience.</p></div>
            
            <div class="form-content">
                <div class="tabs"><button class="tab-item active" data-placeholder="Paste Reel/Photo/Story URL...">Media</button></div>
                <div id="url-input-wrapper"><input type="text" id="url-input" placeholder="Paste Reel/Photo/Story URL..." autocomplete="off"></div>
            </div>

            <div class="ready-state-content">
                <p style="margin-bottom:20px; color:var(--text-muted);">Select Quality</p>
                <!-- NAYE BUTTONS YAHAN HAIN -->
                <div class="quality-selector">
                    <button class="quality-btn active" data-quality="720" data-sound="tiny">720p HD</button>
                    <button class="quality-btn" data-quality="1080" data-sound="tiny">1080p FHD</button>
                    <button class="quality-btn" data-quality="360" data-sound="tiny">360p SD</button>
                </div>
                <button class="download-btn" id="start-download" data-sound="confirm">Start Download</button>
            </div>

            <div class="progress-state-content">
                 <div class="progress-bar-container"><div class="progress-bar" id="progress-bar"></div></div>
                 <p id="progress-text">Initiating...</p>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const card = document.getElementById('downloader-card');
            const urlInput = document.getElementById('url-input');
            const startDownloadBtn = document.getElementById('start-download');
            const qualityBtns = document.querySelectorAll('.quality-btn');
            let uiState = 'idle';

            function setUiState(newState) {
                uiState = newState;
                card.className = 'downloader-card';
                if (newState !== 'idle') card.classList.add(`state-${newState}`);
            }

            // --- JAVASCRIPT FOR QUALITY BUTTONS ---
            qualityBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    qualityBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });

            function startActualDownload() {
                const urlToDownload = urlInput.value.trim();
                if (!urlToDownload) return;

                // YEH LINE NAYI HAI: Hum selected quality ko padh rahe hain
                const selectedQuality = document.querySelector('.quality-btn.active').dataset.quality;

                setUiState('downloading');
                const progressBar = document.getElementById('progress-bar');
                const progressText = document.getElementById('progress-text');
                progressText.textContent = "Connecting...";

                // YEH FETCH CALL UPDATE HUA HAI: Ab hum quality bhi bhej rahe hain
                fetch('/api/get_link', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: urlToDownload, quality: selectedQuality }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const link = document.createElement('a');
                        link.href = data.download_url;
                        link.setAttribute('download', data.filename || 'download');
                        document.body.appendChild(link);
                        link.click();
                        link.remove();
                        progressText.textContent = "Download Complete!";
                        progressBar.style.width = '100%';
                        setTimeout(() => { urlInput.value = ''; setUiState('idle'); }, 2000);
                    } else {
                        throw new Error(data.error);
                    }
                })
                .catch(error => {
                    progressText.textContent = `Error: ${error.message}`;
                    setTimeout(() => setUiState('idle'), 4000);
                });
            }
            startDownloadBtn.addEventListener('click', startActualDownload);

            urlInput.addEventListener('input', () => {
                if (urlInput.value.trim().length > 5) {
                    if (uiState === 'idle') setUiState('ready');
                } else if (uiState === 'ready') {
                    setUiState('idle');
                }
            });
            
            // --- BAAKI SARA CODE WAISA HI HAI ---
            const title = "Singularity";
            const titleContainer = document.querySelector('.header h1');
            title.split('').forEach((letter, i) => { const span = document.createElement('span'); span.textContent = letter; span.style.animationDelay = `${0.5 + i * 0.05}s`; titleContainer.appendChild(span); });
            card.addEventListener('mousemove', (e) => { const rect = card.getBoundingClientRect(); const x = e.clientX - rect.left; const y = e.clientY - rect.top; const { width, height } = rect; const rotateX = ((y / height) - 0.5) * -15; const rotateY = ((x / width) - 0.5) * 15; card.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`; });
            card.addEventListener('mouseleave', () => { card.style.transform = 'rotateX(0) rotateY(0)'; });
            // Particles and sound code omitted for brevity but should be kept
        });
    </script>
</body>
</html>
